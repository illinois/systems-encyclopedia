---
title: Memory Paging

date: 2022-11-30
eleventyExcludeFromCollections: true

authors:
- kennel2
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-a11y-dark.min.css" integrity="sha512-bd1K4DEquIavX49RSZHIE0Ye6RFOVlGLhtGow9KDbLYqOd/ufhshkP0GoJoVR1jqj7FmOffvVIKuq1tcXlN9ZA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">


# Memory Paging

**Paging** is the practice of structuring virtual memory into larger chunks called **pages** in order to significantly reduce the complexity of mapping virtual memory to physical memory and allow virtual memory to use auxiliary memory in addition to main memory. Here, we will examine how memory paging works and why it is essential.

## Overview

### How does memory paging work?

In a paged memory system, each page is typically 4096 bytes (4 KiB) long, although varying implementations can use any page size that is a power of two. Every page of virtual memory is mapped to an equally sized, contiguous unit of physical memory called a **page frame**. Whenever a process attempts to manipulate a virtual page, address that program access is translated to the address of that page frame. To keep track of where virtual pages get mapped to, modern OSes give each process an internal data structure called a **page table**.

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="50%" height="50%" display="block" margin="auto" viewBox="-0.5 -0.5 712 532" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-08-15T18:38:55.290Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot; etag=&quot;ZbXo9RkH4u4zthnCXP9J&quot; version=&quot;20.1.1&quot;&gt;&lt;diagram id=&quot;Z00uC2SatL4r7QjCFoRb&quot; name=&quot;Page-1&quot;&gt;7Vvfk5o6FP5rfLwdIAT0cXW77cO9tzvXTrt9jBCBWSBOiFX3r7+JEBXIuqkLQqU64yQn4US+78uPc9ARmCXbTxStwn+Ij+ORZfjbEbgfWZYzcfinMOxygw3GuSGgkZ+bzKNhHr3gwmgU1nXk46zUkRESs2hVNnokTbHHSjZEKdmUuy1JXB51hQJcM8w9FNet3yOfhbl1DI2j/TOOglCObBpFS4Jk58KQhcgnmxMT+DgCM0oIy0vJdoZjgZ3EJb/u4ZXWwxejOGU6F/w7fbLCp9Cbj/+bfHrBLvq+Dv4qvPxE8bq44eLLsp1EgJJ16mPhxBiB6SaMGJ6vkCdaN5xybgtZEvOayYsZo+T5gBS/x2kxAKYMb1/95uYBD64jTBLM6I53kRe4BYSFhqxxUd8cGTElzOEpG7IjKlQQHHwfgeKFAqtfwM1S4ObEfNjpihcCUXgUyrIMUzbwcQ5ttwSy0xbGQBtj6zfFGNhdY2xrYwx+U4xto2uM4c2vFdDpGmPn5tcKx+oaY/fm1wqn8z3PVB3IKiB/u5vzHmTJPx4p8XCWaS8dHCpWxhXFUZDysschw5QbBKARP//eFQ1J5Pvi8inFWfSCFntXgrAViVK2v384HcF74WvNSJaf4I+UzUhM6H504OxfvGUZxfGJfQnFW9hJyk7s+aul442pSTVsjWr9M+TXPewieqEXkM4Dj5UoeusFfnuiLfJZ+ffiYEDec7Cfq1/WLI5SSa+P6PMX7iZiAlLjgwHLRmtvVc/dqgCW2PE8lWR8d7IwjGYkYFuwLAHVbJ9cNYwwJwoN9G6ZdJ3y3AFAc+6A1tZJOdq5yfNAUXK1U1VF0T7C46VS0Y43xotlx8S0x4vG/iV5ucpJrJOVpsbLpHNeNDYbyctVTm+9mC827JwXjSSH5MUeDC9Q93DWHi8aiRHJCxzMOgbdznnRSKZIXpzB8OJ0vu8DnWRtuMtEZMm7JTghYtQ/IetZlivxiirLZipYbi1kBfopoNdCVr1DX/9D1utsjNWQVZloHcO6BNoLWYEqZNXJUOkxP9zpXntwoRs0tDbd5dOpc9kJnPp34jG7IChGGV/gy+yVt9f8cuzXnrm/CdIJCPAMBhTHiEU/y+5VwBQjPAqJHDmwJmUOgFnBNiNr6uHiqiO8NUe29YYjhmiAWc3RnqfDbb+DOo0H+zdOndsUdVVHbVOnCtUHRZ1tN0RdzVHb1KlOwYOiDk4aoq7mqG3qVAH/oKhzqueIS6mrOWqbOlVOYFDUuU0dU2qO2qZO9buNd1HHCaK7p9PKD1H5AGX1fnvaeL8ratrhnWHYs+nDL4jEMnIQz8CQ33VXanLeWnp11eRUEhbw2tuvKj0xQDUZfVLTxduKCztW07hpNb3O/qU6a1I1oE+quXhHc6o/6aqmvNtWjcYvOt6pmumDOzPdnqim03NQVTUXp2uqqqk9KGlZNRKPoajG7pVqLs0UVVUDrCurpvEkX79VA/ukmouTVDXVNJbp4NXj38ny7sf/5IGP/wM=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="1" y="70" width="120" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><rect x="1" y="70" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 100px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 1</p></div></div></div></foreignObject><text x="61" y="104" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 1</text></switch></g><rect x="1" y="130" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 160px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 2</p></div></div></div></foreignObject><text x="61" y="164" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 2</text></switch></g><rect x="1" y="190" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 220px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 3</p></div></div></div></foreignObject><text x="61" y="224" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 3</text></switch></g><rect x="1" y="350" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 380px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 1</p></div></div></div></foreignObject><text x="61" y="384" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 1</text></switch></g><rect x="1" y="410" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 440px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 2</p></div></div></div></foreignObject><text x="61" y="444" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 2</text></switch></g><rect x="1" y="470" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 500px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page 3</p></div></div></div></foreignObject><text x="61" y="504" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page 3</text></switch></g><rect x="1" y="0" width="120" height="50" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 25px; margin-left: 61px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: nowrap;"><p>VAS of Process 1</p></div></div></div></foreignObject><text x="61" y="29" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">VAS of Process 1</text></switch></g><path d="M 256 70 L 426 70 L 446 90 L 446 250 L 276 250 L 256 230 L 256 70 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 256 70 L 426 70 L 446 90 L 276 90 Z" fill-opacity="0.05" fill="#000000" stroke="none" pointer-events="all"/><path d="M 256 70 L 276 90 L 276 250 L 256 230 Z" fill-opacity="0.1" fill="#000000" stroke="none" pointer-events="all"/><path d="M 276 250 L 276 90 L 256 70 M 276 90 L 446 90" fill="none" stroke="#d79b00" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 170px; margin-left: 277px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page Table for Process 1</p></div></div></div></foreignObject><text x="361" y="174" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page Table for Process 1</text></switch></g><rect x="591" y="120" width="120" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><rect x="591" y="120" width="120" height="60" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 150px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 1</p></div></div></div></foreignObject><text x="651" y="154" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 1</text></switch></g><rect x="591" y="180" width="120" height="60" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 210px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 2</p></div></div></div></foreignObject><text x="651" y="214" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 2</text></switch></g><rect x="591" y="240" width="120" height="60" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 270px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 3</p></div></div></div></foreignObject><text x="651" y="274" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 3</text></switch></g><rect x="591" y="300" width="120" height="60" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 330px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 4</p></div></div></div></foreignObject><text x="651" y="334" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 4</text></switch></g><rect x="591" y="360" width="120" height="60" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 390px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 5</p></div></div></div></foreignObject><text x="651" y="394" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 5</text></switch></g><rect x="591" y="420" width="120" height="60" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 450px; margin-left: 592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Frame 6</p></div></div></div></foreignObject><text x="651" y="454" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Frame 6</text></switch></g><rect x="596" y="50" width="110" height="50" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 75px; margin-left: 651px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: nowrap;"><p>Physical memory</p></div></div></div></foreignObject><text x="651" y="79" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">Physical memory</text></switch></g><path d="M 256 350 L 421 350 L 441 370 L 441 530 L 276 530 L 256 510 L 256 350 Z" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 256 350 L 421 350 L 441 370 L 276 370 Z" fill-opacity="0.05" fill="#000000" stroke="none" pointer-events="all"/><path d="M 256 350 L 276 370 L 276 530 L 256 510 Z" fill-opacity="0.1" fill="#000000" stroke="none" pointer-events="all"/><path d="M 276 530 L 276 370 L 256 350 M 276 370 L 441 370" fill="none" stroke="#6c8ebf" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 163px; height: 1px; padding-top: 450px; margin-left: 277px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p>Page Table for Process 2</p></div></div></div></foreignObject><text x="359" y="454" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Page Table for Process 2</text></switch></g><rect x="1" y="280" width="120" height="50" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 305px; margin-left: 61px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: nowrap;"><p>VAS of Process 2</p></div></div></div></foreignObject><text x="61" y="309" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">VAS of Process 2</text></switch></g><path d="M 121 100 L 244.63 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 100 L 242.88 103.5 L 244.63 100 L 242.88 96.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 121 160 L 244.63 160" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 160 L 242.88 163.5 L 244.63 160 L 242.88 156.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 121 230 L 244.63 230" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 230 L 242.88 233.5 L 244.63 230 L 242.88 226.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 121 380 L 244.63 380" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 380 L 242.88 383.5 L 244.63 380 L 242.88 376.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 121 440 L 244.63 440" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 440 L 242.88 443.5 L 244.63 440 L 242.88 436.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 121 500 L 244.63 500" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 249.88 500 L 242.88 503.5 L 244.63 500 L 242.88 496.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 380 L 585.99 273.93" fill="none" stroke="#004cbf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.12 270.69 L 586.78 277.77 L 585.99 273.93 L 582.45 272.26 Z" fill="#004cbf" stroke="#004cbf" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 440 L 588.23 155.73" fill="none" stroke="#004cbf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.51 151.01 L 590.62 158.83 L 588.23 155.73 L 584.32 155.79 Z" fill="#004cbf" stroke="#004cbf" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 500 L 586.95 334.92" fill="none" stroke="#004cbf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.29 330.86 L 588.54 338.49 L 586.95 334.92 L 583.14 334.04 Z" fill="#004cbf" stroke="#004cbf" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 100 L 585.99 206.07" fill="none" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.12 209.31 L 582.45 207.74 L 585.99 206.07 L 586.78 202.23 Z" fill="#bf7c17" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 160 L 587.69 384.56" fill="none" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.42 389.05 L 583.79 384.89 L 587.69 384.56 L 589.77 381.25 Z" fill="#bf7c17" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 230 L 587.58 444.63" fill="none" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 590.4 449.06 L 583.69 445.03 L 587.58 444.63 L 589.59 441.27 Z" fill="#bf7c17" stroke="#bf7c17" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>

An important aspect of paged virtual memory is that it uses a system of **demand paging**.  In demand paging, every single page is not mapped to a page frame immediately when the process is started. Instead, a page is only mapped to a frame whenever a process attempts to use it for the first time. Demand paging is useful because it is much more likely that a process will not need to use up the entirety of its virtual address space, meaning it makes little sense to allocate the entire virtual address space immediately.

Whenever a process attempts to query a for a page that is valid but is in a page that does not already exist in main memory, the operating system will initiate a procedure called a **page fault**. The behavior of the page fault will depend on what caused it:
- A **minor page fault** occurs if a process has accessed a valid address in a page that has not been mapped to a page frame (i.e. it hasn't officially been allocated by the OS). In this case, the OS will create effectively allocate memory for that page by mapping that page to a page frame.
- A **major page fault** occurs if a valid address is accessed, but that address is in a page that is mapped to something other than main memory. When a major page fault occurs, the operating system will swap the accessed page with one that already exists in main memory. This process is referred to as **page replacement** (covered later).
- An **invalid page fault** occurs if a process attempts to access an address that is not within the bounds of its virtual address space. This will trigger a hardware interrupt from the CPU's memory management unit (MMU) that causes the OS to send a `SIGSEGV` signal and kill the process.

### Why is memory paged?

Memory paging is useful because it allows virtualization to happen at all by significantly reducing the complexity of virtual address translation. To start, let's consider the case of a 32-bit machine (i.e. the virtual address space is 2<sup>32</sup> addresses long) &mdash; if the operating system kept a table that tracked every individual address mapping instead of page mappings, the operating system would need to provide a table containing 2<sup>32</sup> total mappings. Assuming each entry is only 4 bytes large, it would take roughly 2<sup>32</sup> * 4 = 4 GiB to store the address translation table. If every process consumed 4 GiB of memory right out of the gate, virtual memory would be pointless!

Paging is the better option here, since it reduces the total number of entries in the translation table. Since pages are 4096 (2<sup>12</sup>) bytes long, every virtual address space is divided into a smaller number of units, making it so that each page table only needs to hold 2<sup>32</sup> / 2<sup>12</sup> = 2<sup>20</sup> entries. If every entry is 4 bytes large, our page table is only 2<sup>20</sup> * 4 = 4 MiB large! This significantly reduces the memory overhead of memory mappings, and ultimately makes virtual memory possible in the first place.

Most 64-bit operating systems will extend this concept even further. To reduce the memory overhead of page tables even more, modern operating systems use a system of multilevel page tables, which involve a series of lookups to reach the physical address of a translation. You can learn more about multilevel page tables [here](https://www.youtube.com/watch?v=hd8bYx7QCS0).

## Page replacement

Since many processes are able to run and consume main memory at the same time, and all of these different processes have varying levels of demand for memory, it is very possible that a system will incur major page faults, and have to move some pages to auxiliary memory. Whenever a major page fault triggers, the operating system performs a **page replacement** (also referred to as page eviction), picking a page that already exists in main memory and moving it to auxiliary memory to create space for the page that created the page fault.

However, because many different pages are being accessed by every process, operating systems need a principled way to figure out which pages to replace. Major page faults are expensive because they involve copying a page from auxiliary memory into main memory, so it is to the benefit of the operating system to reduce the number of major page faults by replacing pages that will not need to be used in the future. So, page replacement algorithms attempt to minimize the number of total page faults by finding the page that it thinks will need to be replaced the farthest in the future (thus minimizing the number of total page faults per unit of time). 

From here, we will cover a number of heuristic algorithms used to approximate the best possible page to replace, explain how they work, and explain why some of these algorithms are better than others. For each algorithm, we will use a toy machine with main memory capable of holding 4 pages at the same time for sake of example.

### Clairvoyant replacement

Clairvoyant replacement is a theoretically optimal but practically impossible page replacement strategy. In clairvoyant replacement, the operating system is miraculously capable of looking into the future to see when pages need to be replaced. When a page fault occurs, the operating system will evict the page that is used farthest in the future:

![img](../static/paging/clairvoyant.gif)

While clairvoyant replacement is obviously impossible, it is a helpful model to reason about what makes a page replacement strategy good. Because the operating system evicts the page that is used farthest in the future, the operating system is able to minimize the number of major page faults that occur.

### Least Frequently Used (LFU)

In a **least frequently used** (LFU) page caching scheme, the operating system will keep track of how many times memory in each page has been accessed. Whenever a page fault occurs, the cache will evict the page that has been used the least frequently:

![img](../static/paging/lfu.gif)

LFU is an intuitive and simple page replacement scheme. However in practice, it can be a worse page caching algorithm because of **locality of reference**, which is the tendency of computer programs to access the same region of memory many times in a short period of time. Typically, a page that has been accessed many times in a short period will have a high use count regardless of if it needs to be used in the future, meaning that these pages will not be replaced even if they are not needed. How can we improve?

### Least Recently Used (LRU)

In **least recently used** (LRU) caching, the OS will keep track of which pages have been the most recently used, and on page fault will evict the least recently used page.

![img](../static/paging/lru.gif)

LRU caching avoids the pitfalls of LFU since it does not give any main memory priority to pages that have been accessed many times. However, LRU is still only a rough approximation of the optimal page replacement strategy, and thus isn't perfect.

### Not Recently Used (NRU)

**Not recently used** (NRU) caching is a more elaborate variant of LRU caching. In NRU caching, each page in main memory is assigned a "recently used" bit. Whenever a page is accessed, the recently used bit is set to 1. Once every page in main memory has its RU bit set to 1, every bit is then set to zero. When a major page fault occurs, the page that is replaced will be the least recently used page that has its RU bit set to 0:

![img](../static/paging/nru.gif)

## Further Reading

From the Systems Encyclopedia:
- [Virtual Memory](../vmem)